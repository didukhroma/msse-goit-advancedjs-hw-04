{"version":3,"file":"commonHelpers.js","sources":["../src/js/common.js","../src/js/api.js","../src/js/helpers.js","../src/js/iziToast.js","../src/js/homeWork.js"],"sourcesContent":["export const AUTH_TOKEN = '20604497-76eef09585394ebdddc8f0af4';\r\n\r\nexport const MAX_RES_PER_PAGE = 40;\r\n\r\nexport const ref = {\r\n  form: document.querySelector('#search-form'),\r\n  gallery: document.querySelector('.gallery'),\r\n  loadMore: document.querySelector('.load-more'),\r\n};\r\n","import axios from 'axios';\r\nimport { AUTH_TOKEN, MAX_RES_PER_PAGE } from './common';\r\n\r\n/**\r\n *\r\n */\r\naxios.defaults.baseURL = 'https://pixabay.com/api/';\r\naxios.defaults.params = {\r\n  key: AUTH_TOKEN,\r\n  image_type: 'photo',\r\n  per_page: MAX_RES_PER_PAGE,\r\n};\r\n\r\nexport function fetchPhotos(query = '', page = 1) {\r\n  return axios({\r\n    params: {\r\n      q: query,\r\n      page: page,\r\n    },\r\n  });\r\n}\r\n\r\nexport function checkResponseStatus(response) {\r\n  if (response.status !== 200) throw new Error(response.statusText);\r\n  return response.data;\r\n}\r\n","export function prepareQueryForRequest(query) {\r\n  return query.trim().toLowerCase().replace(/\\s/g, '+');\r\n}\r\n\r\nexport function createMarkup(data) {\r\n  return data\r\n    .map(\r\n      ({\r\n        webformatURL,\r\n        tags,\r\n        likes,\r\n        views,\r\n        largeImageURL,\r\n        comments,\r\n        downloads,\r\n      }) => {\r\n        return `<div class=\"photo-card\" data-text=${tags} data-large=${largeImageURL}>\r\n    <div class=\"photo-wrapper\" >\r\n    <img class=\"photo\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\"  />\r\n    </div>\r\n    <div class=\"info\">\r\n        <p class=\"info-item\">\r\n            <b>Likes</b>${likes}\r\n        </p>\r\n            <p class=\"info-item\">\r\n        <b>Views</b>${views}\r\n        </p>\r\n        <p class=\"info-item\">\r\n            <b>Comments</b>${comments}\r\n        </p>\r\n        <p class=\"info-item\">\r\n            <b>Downloads</b>${downloads}\r\n        </p>\r\n    </div>\r\n</div>`;\r\n      }\r\n    )\r\n    .join('');\r\n}\r\n","//Import\r\nimport iziToast from 'izitoast';\r\nimport 'izitoast/dist/css/iziToast.min.css';\r\n// iziToast.addEventListener('touchstart', function handle() {}, {\r\n//   passive: true,\r\n// });\r\n/**\r\n * Delay time for iziToast error message\r\n *\r\n * @type {Number} - time in milliseconds\r\n * @example const DELAY_TIME = 3000;\r\n */\r\nconst DELAY_TIME = 30000;\r\n\r\nconst ERROR_DEFAULT_MESSAFE =\r\n  'Sorry, there are no images matching your search query. Please try again';\r\n/**\r\n * Settings for iziToast \r\n * \r\n * @type {{  timeout: number; position: string; }}\r\n * @example const iziToastSettings = {\r\n  title: 'Error',\r\n  timeout: DELAY_TIME,\r\n  position: 'topCenter',\r\n  message: 'Oops! Something went wrong! Try reloading the page!',\r\n};\r\n*\r\n* @description Read more about iziToast settings at https://izitoast.marcelodolza.com/\r\n */\r\n// const iziToastSettings = {\r\n//   timeout: DELAY_TIME,\r\n//   position: 'topRight',\r\n// };\r\n\r\n/**\r\n * Show iziToast error message\r\n *@param {Number} totalHits  - total results\r\n * @export function\r\n * @example function errorToast() {\r\n  iziToast.error(iziToastSettings);\r\n}\r\n*@description Read more about iziToast settings at https://izitoast.marcelodolza.com/\r\n */\r\n\r\nconst iziToastSettings = {\r\n  title: 'Hooray!',\r\n  message: `We found 500 images.`,\r\n  timeout: DELAY_TIME,\r\n  position: 'topRight',\r\n};\r\nexport function successToast() {\r\n  // iziToastSettings.title = 'Hooray!';\r\n  // iziToastSettings.message = `We found ${totalHits} images.`;\r\n  iziToast.success(iziToastSettings);\r\n}\r\n\r\nexport function errorToast(message = ERROR_DEFAULT_MESSAFE) {\r\n  iziToastSettings.title = 'Error';\r\n  iziToastSettings.message = message;\r\n  return iziToast.error(iziToastSettings);\r\n}\r\n\r\nexport function warningToast() {\r\n  iziToastSettings.title = 'Warning';\r\n  iziToastSettings.message =\r\n    'Oops! Something went wrong! Try to change search query';\r\n  return iziToast.warning(iziToastSettings);\r\n}\r\n","import throttle from 'lodash.throttle';\r\nimport { fetchPhotos, checkResponseStatus } from './api';\r\nimport { MAX_RES_PER_PAGE, ref } from './common';\r\nimport { prepareQueryForRequest, createMarkup } from './helpers';\r\nimport { successToast, warningToast, errorToast } from './iziToast';\r\n// import { galleryLightBox } from './simpleLightBox';\r\n\r\nlet searchQuery = '';\r\nlet page = 1;\r\n\r\nconst input = ref.form.elements.searchQuery;\r\n\r\nref.form.addEventListener('submit', handleSubmit);\r\ninput.addEventListener('input', throttle(handleInput, 300)); //hide button load more when change search query\r\n// ref.loadMore.addEventListener('click', handleClick);\r\n\r\nfunction handleInput() {\r\n  const buttonSearch = ref.form.elements[1];\r\n  if (!input.value) {\r\n    buttonSearch.disabled = true;\r\n    return;\r\n  }\r\n  if (!buttonSearch.disabled) return;\r\n  buttonSearch.disabled = false;\r\n}\r\n\r\nfunction handleSubmit(e) {\r\n  e.preventDefault();\r\n  successToast();\r\n\r\n  const query = prepareQueryForRequest(\r\n    e.currentTarget.children.searchQuery.value\r\n  );\r\n\r\n  if (query !== searchQuery) {\r\n    ref.loadMore.classList.add('visually-hidden');\r\n    searchQuery = query;\r\n    ref.gallery.innerHTML = '';\r\n  }\r\n\r\n  fetchPhotos(query, page)\r\n    .then(checkResponseStatus)\r\n    .then(({ total, totalHits, hits }) => {\r\n      // if (!total) {\r\n      //   ref.loadMore.classList.add('visually-hidden');\r\n      //   errorToast();\r\n      //   throw new Error('');\r\n      // }\r\n\r\n      // if (totalHits < MAX_RES_PER_PAGE)\r\n      //   ref.loadMore.classList.add('visually-hidden');\r\n\r\n      const markup = createMarkup(hits);\r\n      ref.gallery.insertAdjacentHTML('beforeend', markup);\r\n\r\n      // galleryLightBox.refresh();\r\n      ref.loadMore.classList.remove('visually-hidden');\r\n      return totalHits;\r\n    })\r\n    // .then(successToast)\r\n    .catch(error => {\r\n      ref.loadMore.classList.add('visually-hidden');\r\n      errorToast(error.message);\r\n      console.log(error);\r\n    });\r\n\r\n  //Destroys and reinitilized the lightbox, needed for eg. Ajax Calls, or after dom manipulations\r\n}\r\n\r\nasync function handleClick() {\r\n  page += 1;\r\n  let response = '';\r\n\r\n  try {\r\n    response = await getPhotos(searchQuery, page);\r\n    if (response.status !== 200) throw new Error(response.statusText);\r\n  } catch (error) {\r\n    errorToast(error);\r\n    console.log(error);\r\n  }\r\n\r\n  const { total, totalHits, hits } = response.data;\r\n\r\n  if (!total) {\r\n    warningToast();\r\n    return;\r\n  }\r\n\r\n  successToast(totalHits); //!----------------Violation\r\n  const markup = createMarkup(hits);\r\n  ref.gallery.insertAdjacentHTML('beforeend', markup);\r\n}\r\n"],"names":["AUTH_TOKEN","MAX_RES_PER_PAGE","ref","axios","fetchPhotos","query","page","checkResponseStatus","response","prepareQueryForRequest","createMarkup","data","webformatURL","tags","likes","views","largeImageURL","comments","downloads","DELAY_TIME","ERROR_DEFAULT_MESSAFE","iziToastSettings","successToast","iziToast","errorToast","message","searchQuery","input","handleSubmit","throttle","handleInput","buttonSearch","total","totalHits","hits","markup","error"],"mappings":"owBAAO,MAAMA,EAAa,qCAEbC,EAAmB,GAEnBC,EAAM,CACjB,KAAM,SAAS,cAAc,cAAc,EAC3C,QAAS,SAAS,cAAc,UAAU,EAC1C,SAAU,SAAS,cAAc,YAAY,CAC/C,ECFAC,EAAM,SAAS,QAAU,2BACzBA,EAAM,SAAS,OAAS,CACtB,IAAKH,EACL,WAAY,QACZ,SAAUC,CACZ,EAEO,SAASG,EAAYC,EAAQ,GAAIC,EAAO,EAAG,CAChD,OAAOH,EAAM,CACX,OAAQ,CACN,EAAGE,EACH,KAAMC,CACP,CACL,CAAG,CACH,CAEO,SAASC,EAAoBC,EAAU,CAC5C,GAAIA,EAAS,SAAW,IAAK,MAAM,IAAI,MAAMA,EAAS,UAAU,EAChE,OAAOA,EAAS,IAClB,CCzBO,SAASC,EAAuBJ,EAAO,CAC5C,OAAOA,EAAM,OAAO,YAAa,EAAC,QAAQ,MAAO,GAAG,CACtD,CAEO,SAASK,EAAaC,EAAM,CACjC,OAAOA,EACJ,IACC,CAAC,CACC,aAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,cAAAC,EACA,SAAAC,EACA,UAAAC,CACR,IACe,qCAAqCL,gBAAmBG;AAAA;AAAA,8BAEzCJ,WAAsBC;AAAA;AAAA;AAAA;AAAA,0BAI1BC;AAAA;AAAA;AAAA,sBAGJC;AAAA;AAAA;AAAA,6BAGOE;AAAA;AAAA;AAAA,8BAGCC;AAAA;AAAA;AAAA,OAKzB,EACA,KAAK,EAAE,CACZ,CC1BA,MAAMC,EAAa,IAEbC,EACJ,0EA6BIC,EAAmB,CACvB,MAAO,UACP,QAAS,uBACT,QAASF,EACT,SAAU,UACZ,EACO,SAASG,GAAe,CAG7BC,EAAS,QAAQF,CAAgB,CACnC,CAEO,SAASG,EAAWC,EAAUL,EAAuB,CAC1D,OAAAC,EAAiB,MAAQ,QACzBA,EAAiB,QAAUI,EACpBF,EAAS,MAAMF,CAAgB,CACxC,CCrDA,IAAIK,EAAc,GACdpB,EAAO,EAEX,MAAMqB,EAAQzB,EAAI,KAAK,SAAS,YAEhCA,EAAI,KAAK,iBAAiB,SAAU0B,CAAY,EAChDD,EAAM,iBAAiB,QAASE,EAASC,EAAa,GAAG,CAAC,EAG1D,SAASA,GAAc,CACrB,MAAMC,EAAe7B,EAAI,KAAK,SAAS,GACvC,GAAI,CAACyB,EAAM,MAAO,CAChBI,EAAa,SAAW,GACxB,MACD,CACIA,EAAa,WAClBA,EAAa,SAAW,GAC1B,CAEA,SAASH,EAAa,EAAG,CACvB,EAAE,eAAc,EAChBN,IAEA,MAAMjB,EAAQI,EACZ,EAAE,cAAc,SAAS,YAAY,KACzC,EAEMJ,IAAUqB,IACZxB,EAAI,SAAS,UAAU,IAAI,iBAAiB,EAC5CwB,EAAcrB,EACdH,EAAI,QAAQ,UAAY,IAG1BE,EAAYC,EAAOC,CAAI,EACpB,KAAKC,CAAmB,EACxB,KAAK,CAAC,CAAE,MAAAyB,EAAO,UAAAC,EAAW,KAAAC,CAAI,IAAO,CAUpC,MAAMC,EAASzB,EAAawB,CAAI,EAChC,OAAAhC,EAAI,QAAQ,mBAAmB,YAAaiC,CAAM,EAGlDjC,EAAI,SAAS,UAAU,OAAO,iBAAiB,EACxC+B,CACb,CAAK,EAEA,MAAMG,GAAS,CACdlC,EAAI,SAAS,UAAU,IAAI,iBAAiB,EAC5CsB,EAAWY,EAAM,OAAO,EACxB,QAAQ,IAAIA,CAAK,CACvB,CAAK,CAGL"}